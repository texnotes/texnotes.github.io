<!DOCTYPE html>

<html>
<head>
  <title>taglist.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>taglist.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span class="hljs-pi">	'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Полифил метода <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Compatibility">Function.prototype.bind</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Function</span>.prototype.bind) {
	<span class="hljs-built_in">Function</span>.prototype.bind = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(oThis)</span> {</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span> !== <span class="hljs-string">"function"</span>) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Function.prototype.bind - what is trying to be bound is not callable"</span>);
		}
		<span class="hljs-keyword">var</span> aArgs = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>),
		fToBind = <span class="hljs-keyword">this</span>,
		fNOP = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>},
		fBound = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">return</span> fToBind.apply(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> fNOP &amp;&amp; oThis ? <span class="hljs-keyword">this</span> : oThis, aArgs.concat(<span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>)));
		};
		fNOP.prototype = <span class="hljs-keyword">this</span>.prototype;
		fBound.prototype = <span class="hljs-keyword">new</span> fNOP();
		<span class="hljs-keyword">return</span> fBound;
	};
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Полифил метода <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every#Compatibility">arr.every</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.prototype.every) {
	<span class="hljs-built_in">Array</span>.prototype.every = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fun <span class="hljs-comment">/*, thisArg */</span>
	)</span> {</span>
<span class="hljs-pi">		'use strict'</span>;

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || <span class="hljs-keyword">this</span> === <span class="hljs-literal">null</span>)
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>();

		<span class="hljs-keyword">var</span> t = <span class="hljs-built_in">Object</span>(<span class="hljs-keyword">this</span>);
		<span class="hljs-keyword">var</span> len = t.length &gt;&gt;&gt; <span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fun !== <span class="hljs-string">'function'</span>)
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>();

		<span class="hljs-keyword">var</span> thisArg = <span class="hljs-built_in">arguments</span>.length &gt;= <span class="hljs-number">2</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
			<span class="hljs-keyword">if</span> (i <span class="hljs-keyword">in</span> t &amp;&amp; !fun.call(thisArg, t[i], i, t))
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	};
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Полифил метода <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter#Compatibility">arr.filter</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.prototype.filter) {
	<span class="hljs-built_in">Array</span>.prototype.filter = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fun <span class="hljs-comment">/*, thisArg */</span>
	)</span> {</span>
<span class="hljs-pi">		"use strict"</span>;

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || <span class="hljs-keyword">this</span> === <span class="hljs-literal">null</span>)
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>();

		<span class="hljs-keyword">var</span> t = <span class="hljs-built_in">Object</span>(<span class="hljs-keyword">this</span>);
		<span class="hljs-keyword">var</span> len = t.length &gt;&gt;&gt; <span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fun != <span class="hljs-string">"function"</span>)
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>();

		<span class="hljs-keyword">var</span> res = [];
		<span class="hljs-keyword">var</span> thisArg = <span class="hljs-built_in">arguments</span>.length &gt;= <span class="hljs-number">2</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
			<span class="hljs-keyword">if</span> (i <span class="hljs-keyword">in</span> t) {
				<span class="hljs-keyword">var</span> val = t[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>NOTE: Technically this should Object.defineProperty at
      the next index, as push can be affected by
      properties on Object.prototype and Array.prototype.
      But that method’s new, and collisions should be
      rare, so use the more-compatible alternative.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (fun.call(thisArg, val, i, t))
					res.push(val);
			}
		}

		<span class="hljs-keyword">return</span> res;
	};
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Utilities - small javascript functions-utilites for everyday use by <a href="https://github.com/podgorniy/javascript-toolbox">GitHub: Dmitry Podgorniy</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEvent</span><span class="hljs-params">(obj, event_name, handler)</span> {</span>
		<span class="hljs-keyword">var</span> handler_wrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
			event = event || window.event;
			<span class="hljs-keyword">if</span> (!event.target &amp;&amp; event.srcElement) {
				event.target = event.srcElement;
			}
			<span class="hljs-keyword">return</span> handler.call(obj, event);
		};

		<span class="hljs-keyword">if</span> (obj.addEventListener) {
			obj.addEventListener(event_name, handler_wrapper, <span class="hljs-literal">false</span>);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj.attachEvent) {
			obj.attachEvent(<span class="hljs-string">'on'</span> + event_name, handler_wrapper);
		}
		<span class="hljs-keyword">return</span> handler_wrapper;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasClass</span><span class="hljs-params">(node, className)</span> {</span>
		<span class="hljs-keyword">return</span> (<span class="hljs-string">' '</span> + node.className + <span class="hljs-string">' '</span>).indexOf(<span class="hljs-string">' '</span> + className + <span class="hljs-string">' '</span>) !== -<span class="hljs-number">1</span>;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>В функции, используемой Дмитрием, есть особенность 
-если вставлять класс, туда где нет классов, то перед первым классом появляется пробел.
Оставил код, если будет время постараюсь исправить!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/****	function addClass(node, className) {
		var nodeClasses = node.className.split(' ');

		if (nodeClasses.every(function (assignedClass) {
				return assignedClass !== className;
			})) {
			nodeClasses.push(className);
		}
		node.className = nodeClasses.join(' ');
	}****/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Использовал решение Кантора <a href="http://javascript.ru/unsorted/top-10-functions#7-addclass-removeclass">javascript.ru</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addClass</span><span class="hljs-params">(o, c)</span>{</span>
    <span class="hljs-keyword">var</span> re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"(^|\\s)"</span> + c + <span class="hljs-string">"(\\s|$)"</span>, <span class="hljs-string">"g"</span>)
    <span class="hljs-keyword">if</span> (re.test(o.className)) <span class="hljs-keyword">return</span>
    o.className = (o.className + <span class="hljs-string">" "</span> + c).replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">" "</span>).replace(<span class="hljs-regexp">/(^ | $)/g</span>, <span class="hljs-string">""</span>)
}
 
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeClass</span><span class="hljs-params">(node, className)</span> {</span>
		node.className = node.className.split(<span class="hljs-string">' '</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(assignedClass)</span> {</span>
				<span class="hljs-keyword">return</span> assignedClass !== className;
			}).join(<span class="hljs-string">' '</span>);
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Класс виджита “Показ/Редактирование Тегов”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TagList</span><span class="hljs-params">(node, tags)</span> {</span> <span class="hljs-comment">//Конструктор класса</span>
		<span class="hljs-keyword">this</span>.myTags = tags || []; <span class="hljs-comment">//Теги переданые конструктору (предопределенные пользователем) </span>
		<span class="hljs-keyword">this</span>.nodeID = <span class="hljs-literal">null</span>; <span class="hljs-comment">//Привязка к разметке виджита (появится после вызова метода startTag)</span>

		<span class="hljs-keyword">this</span>.startTag(node); <span class="hljs-comment">//Создаем разметочку для виджита</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Навешиваем обработчики событий</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		addEvent(<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>), <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.clickTagEdit.bind(<span class="hljs-keyword">this</span>));
		addEvent(<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.btn.btn-info'</span>), <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.newTagBtn.bind(<span class="hljs-keyword">this</span>));
		addEvent(<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.taglink'</span>), <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.deleteTag.bind(<span class="hljs-keyword">this</span>));
		addEvent(<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.form-control'</span>), <span class="hljs-string">'keyup'</span>, <span class="hljs-keyword">this</span>.newTagEnter.bind(<span class="hljs-keyword">this</span>));
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Метод - генерируем разметку для виджита    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.startTag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node)</span> {</span>
		<span class="hljs-keyword">var</span> my_div = document.createElement(<span class="hljs-string">'div'</span>);
		my_div.className = <span class="hljs-string">"taglist"</span>; <span class="hljs-comment">//Основной css-класс виджита</span>

		<span class="hljs-keyword">var</span> my_innerText = <span class="hljs-string">'&lt;a href="#"&gt;Редактировать теги&lt;/a&gt;&lt;div class="taglink"&gt;'</span>;<span class="hljs-comment">//Создаем css-класс для тегов </span>
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.myTags){
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.myTags.length; i += <span class="hljs-number">1</span>) {
			my_innerText = my_innerText + <span class="hljs-string">'&lt;span class="label label-primary"&gt;'</span> + <span class="hljs-keyword">this</span>.myTags[i] + <span class="hljs-string">'&lt;/span&gt; '</span>;
			}
		}
		my_innerText = my_innerText + <span class="hljs-string">'&lt;/div&gt;&lt;div class="input-group"&gt;&lt;input placeholder="Введите новый тег" autofocus="autofocus" class="form-control"&gt;&lt;span class="input-group-btn"&gt;&lt;button type="submit" class="btn btn-info"&gt;добавить&lt;/button&gt;&lt;/span&gt;&lt;/div&gt;'</span>;
		my_div.innerHTML = my_innerText; <span class="hljs-comment">//Разметка для поля ввода тега</span>
		<span class="hljs-keyword">this</span>.nodeID = node.appendChild(my_div);

		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.input-group'</span>).style.display = <span class="hljs-string">'none'</span>;<span class="hljs-comment">//При инициализации разметки не показываем поле ввода тегов</span>

	};</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Выбор режима виджита: показ/редактирование тегов     </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.clickTagEdit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>).innerHTML === <span class="hljs-string">"Редактировать теги"</span>){
			<span class="hljs-keyword">this</span>.editTagYes();}
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>).innerHTML === <span class="hljs-string">"Завершить редактирование"</span>){
			<span class="hljs-keyword">this</span>.editTagNo();}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Режима виджита: редактирование тегов       </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.editTagYes = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> 
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.input-group'</span>).style.display = <span class="hljs-string">'table'</span>;<span class="hljs-comment">//Меняем внешний вид виджита  </span>
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>).innerHTML = <span class="hljs-string">'Завершить редактирование'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Отображаем теги, которые храним в DOM (добавляет разметку для редактирования)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> tTags = <span class="hljs-keyword">this</span>.nodeID.querySelectorAll(<span class="hljs-string">'.label-primary'</span>);
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; tTags.length; i += <span class="hljs-number">1</span>) {
			removeClass(tTags[i], <span class="hljs-string">'label-primary'</span>);
			addClass(tTags[i], <span class="hljs-string">'label-danger'</span>);
			tTags[i].innerHTML = tTags[i].innerHTML + <span class="hljs-string">'&lt;span data-role="remove"&gt;&lt;/span&gt;'</span>;
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Режима виджита: показ тегов     </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.editTagNo = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.input-group'</span>).style.display = <span class="hljs-string">'none'</span>;<span class="hljs-comment">//Меняем внешний вид виджита</span>
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>).innerHTML = <span class="hljs-string">'Редактировать теги'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Отображаем теги, которые храним в DOM (удаляет разметку для редактирования)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> tTags = <span class="hljs-keyword">this</span>.nodeID.querySelectorAll(<span class="hljs-string">'.label-danger'</span>);
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; tTags.length; i += <span class="hljs-number">1</span>) {
			removeClass(tTags[i], <span class="hljs-string">'label-danger'</span>);
			addClass(tTags[i], <span class="hljs-string">'label-primary'</span>);
			<span class="hljs-keyword">var</span> strTag = tTags[i].innerHTML;
			strTag = strTag.replace(<span class="hljs-string">'&lt;SPAN data-role="remove"&gt;&lt;/SPAN&gt;'</span>, <span class="hljs-string">''</span>);
			<span class="hljs-keyword">if</span> (strTag === tTags[i].innerHTML)
			strTag = strTag.replace(<span class="hljs-string">'&lt;span data-role="remove"&gt;&lt;/span&gt;'</span>, <span class="hljs-string">''</span>);
			tTags[i].innerHTML = strTag;
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Метод getTagList, возвращающий список тегов (массив строк) - получилось очень не оптимально </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.getTagList = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Поскольку, это все-таки домашняя работа, оставил код, как напоминание так не делать. 
Плохо вышло из-за сильной привязки к DOM и его дерганья. Использовать переменную myTags, думаю разумнее!     </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/****	За счет очень упрощенной процедуры парсинга HTML, получили ограничение, что в теге не может быть символа '^'
		var el = this.nodeID.querySelector('.taglink').innerHTML;
		el = el.replace(/[ ]{2,}/g, ' '); //Удаляем повторяющиеся пробелы
		el = el.replace(/&lt;[\/]{0,1}(span|SPAN)[^&gt;&lt;]*&gt;/g, "^");//Удаляем разметку HTML
		el = el.replace(/[\^]{2,}/g, ''); //Удаляем повторяющиеся значки '^'
		el = el.replace(/(^\^)/, '');//Удаляем '^' вначале строки
		el = el.replace(/( \^)/g, '^');//Удаляем пробелы перед '^'
		var arrElm = el.split("^");
****/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Регулярки строил <a href="http://ajaxination.wordpress.com/2010/08/10/javascript-using-regular-expression-to-remove-certain-tags-from-string/">по примеру</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.myTags;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Добавление нового тега по нажатию на кнопке ввода (валитдация данных не выполняется)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.newTagBtn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> texInput = <span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.form-control'</span>).value;
		<span class="hljs-keyword">if</span> (!texInput) {<span class="hljs-keyword">return</span>;} <span class="hljs-comment">//Выход если поле ввода пустое</span>
		<span class="hljs-keyword">var</span> tagArray = <span class="hljs-keyword">this</span>.getTagList();<span class="hljs-comment">//Сравнение с уже введеными тегами </span>
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; tagArray.length; i += <span class="hljs-number">1</span>) {
			<span class="hljs-keyword">if</span> (texInput === tagArray[i]) {<span class="hljs-keyword">return</span>;}
		}
		<span class="hljs-keyword">var</span> el = document.createElement(<span class="hljs-string">"span"</span>);<span class="hljs-comment">//Добавляем тег в DOM</span>
		addClass(el, <span class="hljs-string">'label'</span>);
		addClass(el, <span class="hljs-string">'label-danger'</span>);
		el.innerHTML = texInput + <span class="hljs-string">'&lt;span data-role="remove"&gt;&lt;/span&gt;'</span>;
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.taglink'</span>).appendChild(el);
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.taglink'</span>).innerHTML += <span class="hljs-string">' '</span>;<span class="hljs-comment">//Добавляем пробел из-за кривой разметки (нужно поправить стили)</span>
		<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'.form-control'</span>).value = <span class="hljs-string">''</span>;<span class="hljs-comment">//Очищаем поле ввода</span>

		<span class="hljs-keyword">this</span>.myTags.push(texInput);<span class="hljs-comment">//Добавляем введеное значение (не валитдируем) в массив тегов</span>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.myTags;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Обработчик ввода тега по нажатию на Enter    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.newTagEnter = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
		<span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">13</span>) {<span class="hljs-keyword">this</span>.newTagBtn();
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Реакция на удаление тега (используем делегирование)    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	TagList.prototype.deleteTag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> {</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.nodeID.querySelector(<span class="hljs-string">'a'</span>).innerHTML === <span class="hljs-string">"Редактировать теги"</span>){
			<span class="hljs-keyword">return</span>;}<span class="hljs-comment">//Выход, если не режим редактирования</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Скользкая дорожка, но css специфические по подобию <a href="http://timschlechter.github.io/bootstrap-tagsinput/examples/">проекта</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (!hasClass(event.target, <span class="hljs-string">''</span>)){
			<span class="hljs-keyword">return</span>;}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Удаляем тег из DOM и массива myTegs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> node = event.target.parentElement;
		<span class="hljs-keyword">if</span> (node.parentNode) {
		<span class="hljs-keyword">var</span> el = node.innerHTML;
		el=el.replace(<span class="hljs-string">'&lt;SPAN data-role="remove"&gt;&lt;/SPAN&gt;'</span>,<span class="hljs-string">''</span>);
		el=el.replace(<span class="hljs-string">'&lt;span data-role="remove"&gt;&lt;/span&gt;'</span>,<span class="hljs-string">''</span>);

		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i =<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.myTags.length; i+=<span class="hljs-number">1</span>){
		<span class="hljs-keyword">if</span> (el===<span class="hljs-keyword">this</span>.myTags[i]) {
			<span class="hljs-keyword">this</span>.myTags.splice(i,<span class="hljs-number">1</span>); 
				}
			}
			node.parentNode.removeChild(node);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.myTags;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Хелпер: создаем экземпляр класса для виджита и проброс метода в глобальную область видимости</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeTagList</span><span class="hljs-params">(tagListContainer, tags)</span> {</span>  
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TagList(tagListContainer, tags);
	}
	window.makeTagList = makeTagList;
}
	());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
